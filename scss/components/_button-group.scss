$btngroup-background: $primary-color;
$btngroup-color: #fff;
$btngroup-radius: 4px;

%button-group {
  margin: 0;
  margin-bottom: 1rem;
  list-style-type: none;
  display: inline-flex;

  > li {
    flex: 0 0 auto;

    // Links become buttons
    > a,
    > label {
      @extend %button;
      display: block;
      margin: 0;
    }
    // Add borders between items
    &:not(:last-child) > a,
    &:not(:last-child) > label {
      border-right: 1px solid scale-color($btngroup-background, $lightness: -15%);
    }
    // Remove border radius on inner items
    &:first-child > a,
    &:first-child > label {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    &:not(:first-child):not(:last-child) > a,
    &:not(:first-child):not(:last-child) > label {
      border-radius: 0;
    }
    &:last-child > a,
    &:last-child > label {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
  }
}

%button-group-segmented {
  $main-color: foundation(button, background);
  $hover-color: rgba($main-color, 0.25);

  border: 1px solid $primary-color;
  border-radius: 8px;
  overflow: hidden;

  // Hide the radio button
  > li > input[type="radio"] {
    position: absolute;
    left: -9999px;
  }
  // This is the button
  > li > a,
  > li > label {
    margin-right: 0;
    background: transparent;
  }
}

@mixin button-group-expand($stretch: true) {
  display: if($stretch, flex, inline-flex);

  > li {
    flex: if($stretch, 1, 0 0 auto);

    > a, > label {
      @if $stretch { @include button-expand; }
    }
  }
}
@mixin button-group-style(
  $segmented: false,
  $background: $primary-color,
  $color: #fff
) {

  @if not $segmented {
    > li {
      > a, > label {
        @include button-style($background, $color);
        border-color: scale-color($background, $lightness: -15%);
      }
    }
  }
  @else {
    @extend %button-group-segmented;
    $hover-color: rgba($background, 0.25);
    border-color: $background;

    > li {
      // This is the button
      > a, > label {
        border-color: $background;
        color: $background;

        // This is the button being hovered on
        &:hover {
          background: $hover-color;
          color: $background;
        }
      }

      // This is the button when it's active
      &.is-active > a,
      > input:checked + label {
        &, &:hover {
          background: $background;
          color: if(lightness($background) > 60%, #000, #fff);
        }
      }
    }
  }
}

@mixin button-group(
  $segmented: false,
  $expand: false,
  $background: $primary-color,
  $color: #fff
) {
  @extend %button-group;
  @include button-group-expand($expand);
  @include button-group-style($segmented, $background, $color);
  border-radius: $btngroup-radius;
}

.button-group {
  @include button-group;

  &.secondary { @include button-group-style(false, $secondary-color) }
  &.success   { @include button-group-style(false, $success-color) }
  &.warning   { @include button-group-style(false, $warning-color) }
  &.alert     { @include button-group-style(false, $alert-color) }

  &.segmented { @include button-group-style(true);
    &.secondary { @include button-group-style(true, $secondary-color) }
    &.success   { @include button-group-style(true, $success-color) }
    &.warning   { @include button-group-style(true, $warning-color) }
    &.alert     { @include button-group-style(true, $alert-color) }
  }
  &.expand    { @include button-group-expand; }
}
